import{N as Y,I as j,R as z,o as r,g as k,w as e,a as t,A as Z,e as g,c as p,t as i,j as _,an as G,f as n,F as I,r as O,H as K,V as J,ah as Q,a7 as X,ag as ee,ac as te,S as L,u as se,aJ as ae,bJ as le,i as oe,J as ie,cp as B,ae as ne,af as S,l as R,al as T,b as o,cz as re,Z as ue,aE as N,Y as ce,n as de}from"./app.3dbb9f4f.js";import{u as me}from"./useSelectable.1e30f95c.js";import{_ as fe}from"./PageHeader.5278f6a5.js";import{_ as U,a as pe}from"./PostsFilter.9a745bd5.js";import{T as ve,_ as C}from"./Tab.87218907.js";import{_ as _e}from"./Panel.1435ce07.js";import{_ as F}from"./Checkbox.1a8805b0.js";import{_ as d,a as q,T as he}from"./TableCell.4ea0e0fc.js";import{_ as ge}from"./PureDangerButton.aa10c267.js";import{u as ke}from"./usePostVersions.f18e2fc4.js";import{_ as $e}from"./MediaFile.dd3a1c78.js";import{u as be,_ as M,c as ye,b as we,a as xe}from"./VerticallyScrollableContent.219a26b7.js";import{_ as A}from"./Account.6c1bcc0e.js";import{_ as Ce}from"./SelectableBar.3cd2e649.js";import{_ as Ve}from"./Pagination.b044d7e9.js";import{_ as Ie}from"./NoResult.f7bfb2e6.js";import{T as De}from"./Trash.108c227d.js";import"./Flex.781629fc.js";import"./PureButtonLink.52cd3818.js";import"./EllipsisVertical.6eb78bb2.js";import"./ProviderIcon.fe1a63e2.js";import"./SearchInput.2b4b1fa0.js";import"./ExclamationCircle.5d8a3fe5.js";import"./Variable.cb6cad2c.js";import"./index.d961b7a1.js";import"./EditorReadOnly.f0e86aff.js";import"./Alert.68363348.js";import"./Refresh.1865b3fa.js";import"./ArrowTopRightOnSquare.9c303ffa.js";import"./ColorPicker.a1464b4a.js";import"./ChevronLeft.cbb2bb07.js";const Oe={class:"w-44"},Pe={key:0,class:"text-sm mt-xs text-gray-500"},Re={key:1,class:"text-sm mt-xs text-gray-500"},je={class:"w-96 text-left break-words"},Be={key:0,class:"w-48 flex relative"},Se={key:0,class:"absolute top-0 -right-5 z-10"},Te={class:"flex flex-wrap gap-xs"},Ne={class:"flex gap-xs"},Ue={class:"mr-xs"},Fe={class:"text-left"},Me={class:"mr-xs flex items-center"},Ae={__name:"PostItem",props:{item:{type:Object,required:!0},filter:{type:Object,default:{accounts:[]}}},setup(s){const a=s,{getOriginalVersion:$,getAccountVersion:m}=ke(),{setupURLMetaForAllVersions:P}=be(),f=Y(()=>{if(!a.item.versions.length)return{excerpt:"",media:null,media_count:0};let b=a.item.accounts;a.filter.accounts.length&&(b=b.filter(u=>a.filter.accounts.includes(u.id)));const V=b.map(u=>{const h=m(a.item.versions,u.id);return h?h.content[0]:$(a.item.versions).content[0]}),y=V.length?V[0]:a.item.versions[0].content[0];return{excerpt:y.excerpt,media:y.media.length?y.media[0]:null,media_count:y.media.length}}),w=j(!1),x=()=>{w.value=!0,P(a.item.versions)},D=()=>{w.value=!1};return(b,V)=>{const y=z("tooltip");return r(),k(q,{hoverable:!0},{default:e(()=>[t(d,{class:"w-10"},{default:e(()=>[Z(b.$slots,"checkbox")]),_:3}),t(d,{clickable:!0,onClick:x},{default:e(()=>[g("div",Oe,[t(M,{value:s.item.status},null,8,["value"]),s.item.status==="scheduled"?(r(),p("div",Pe,i(s.item.scheduled_at.human),1)):_("",!0),s.item.status==="published"?(r(),p("div",Re,i(s.item.published_at.human),1)):_("",!0)])]),_:1}),t(d,{clickable:!0,onClick:x,class:"!pl-0"},{default:e(()=>[g("div",je,i(f.value.excerpt),1)]),_:1}),t(d,{clickable:!0,onClick:x},{default:e(()=>[f.value.media?(r(),p("div",Be,[f.value.media?(r(),k($e,{key:0,media:f.value.media,"img-height":"sm",imgWidthFull:!1},{default:e(()=>[f.value.media_count>1?(r(),p("div",Se,[t(G,null,{default:e(()=>[n("+"+i(f.value.media_count-1),1)]),_:1})])):_("",!0)]),_:1},8,["media"])):_("",!0)])):_("",!0)]),_:1}),t(d,{clickable:!0,onClick:x},{default:e(()=>[g("div",Te,[(r(!0),p(I,null,O(s.item.tags,u=>(r(),k(ye,{key:u.id,item:u,removable:!1,editable:!1},null,8,["item"]))),128))])]),_:1}),t(d,null,{default:e(()=>[g("div",Ne,[(r(!0),p(I,null,O(s.item.accounts.slice(0,3),(u,h)=>(r(),p("div",{key:u.id,class:K({"-ml-6":h>0})},[J(t(A,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"]),[[y,u.name]])],2))),128)),s.item.accounts.length>3?(r(),k(Q,{key:0,"width-classes":"w-64",placement:"bottom-end"},{trigger:e(()=>[t(X,{class:"mt-4 font-semibold"},{default:e(()=>[n("+"+i(s.item.accounts.slice(3).length),1)]),_:1})]),content:e(()=>[t(we,null,{default:e(()=>[(r(!0),p(I,null,O(s.item.accounts.slice(3),u=>(r(),k(ee,{as:"div"},{default:e(()=>[g("span",Ue,[t(A,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"])]),g("span",Fe,i(u.name),1)]),_:2},1024))),256))]),_:1})]),_:1})):_("",!0)])]),_:1}),t(d,null,{default:e(()=>[n(i(s.item.user.name),1)]),_:1}),t(d,null,{default:e(()=>[t(U,{itemId:s.item.id,trashed:s.item.trashed,type:s.item.type,status:s.item.status},null,8,["itemId","trashed","type","status"])]),_:1}),t(te,{show:w.value,scrollableBody:!0,onClose:D},{body:e(()=>[t(M,{value:s.item.status,class:"mb-lg"},null,8,["value"]),w.value?(r(),k(xe,{key:0,accounts:s.item.accounts,versions:s.item.versions},null,8,["accounts","versions"])):_("",!0)]),footer:e(()=>[w.value?(r(),p(I,{key:0},[g("div",Me,[t(U,{itemId:s.item.id,trashed:s.item.trashed},null,8,["itemId","trashed"])]),t(L,{onClick:D},{default:e(()=>[n(i(b.$t("general.close")),1)]),_:1})],64)):_("",!0)]),_:1},8,["show"])]),_:3})}}},ze={class:"row-py"},Je={class:"w-full row-px"},Le={class:"w-full row-px mt-lg"},qe={key:0,class:"mt-lg"},yt={__name:"Index",props:{filter:{type:Object,default:{}},posts:{type:Object},has_failed_posts:{type:Boolean,default:!1}},setup(s){const{t:a}=se(),$=s,m=j({keyword:$.filter.keyword,status:$.filter.status,tags:$.filter.tags,accounts:$.filter.accounts}),P=ae({urlMeta:{}});le("postCtx",P);const{selectedRecords:f,putPageRecords:w,toggleSelectRecordsOnPage:x,deselectRecord:D,deselectAllRecords:b}=me(),V=oe("workspaceCtx"),y=()=>$.posts.data.map(v=>v.id);ie(()=>{w(y()),B.on("postDelete",v=>{D(v)})}),ne(()=>{B.off("postDelete")}),S(()=>R.exports.cloneDeep(m.value),R.exports.throttle(()=>{T.get(route("br.posts.index",{workspace:V.id}),R.exports.pickBy(m.value),{preserveState:!0,only:["posts","filter"]})},300)),S(()=>$.posts.data,()=>{w(y())});const{notify:u}=de(),h=j(!1),E=()=>{T.delete(route("br.posts.deleteMultiple",{workspace:V.id}),{data:{posts:f.value,status:m.value.status},onSuccess(){b(),u("success",$.filter.status==="trash"?a("post.posts_deleted"):a("post.posts_to_trash"))},onFinish(){h.value=!1}})};return(v,l)=>{const H=z("tooltip");return r(),p(I,null,[t(o(ue),{title:o(a)("post.posts")},null,8,["title"]),g("div",ze,[t(fe,{title:o(a)("post.posts")},{default:e(()=>[t(pe,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=c=>m.value=c),class:"md:ml-2"},null,8,["modelValue"])]),_:1},8,["title"]),g("div",Je,[t(ve,null,{default:e(()=>[t(C,{onClick:l[1]||(l[1]=c=>m.value.status=null),active:!v.$page.props.filter.status},{default:e(()=>[n(i(o(a)("general.all")),1)]),_:1},8,["active"]),t(C,{onClick:l[2]||(l[2]=c=>m.value.status="pending"),active:v.$page.props.filter.status==="pending"},{default:e(()=>[n(" Pending approval ")]),_:1},8,["active"]),t(C,{onClick:l[3]||(l[3]=c=>m.value.status="draft"),active:v.$page.props.filter.status==="draft"},{default:e(()=>[n(i(o(a)("post.drafts")),1)]),_:1},8,["active"]),t(C,{onClick:l[4]||(l[4]=c=>m.value.status="scheduled"),active:v.$page.props.filter.status==="scheduled"},{default:e(()=>[n(i(o(a)("post.scheduled")),1)]),_:1},8,["active"]),t(C,{onClick:l[5]||(l[5]=c=>m.value.status="published"),active:v.$page.props.filter.status==="published"},{default:e(()=>[n(i(o(a)("post.published")),1)]),_:1},8,["active"]),s.has_failed_posts?(r(),k(C,{key:0,onClick:l[6]||(l[6]=c=>m.value.status="failed"),active:v.$page.props.filter.status==="failed",class:"text-red-500"},{default:e(()=>[n(i(o(a)("post.failed")),1)]),_:1},8,["active"])):_("",!0),t(C,{onClick:l[7]||(l[7]=c=>m.value.status="trash"),active:v.$page.props.filter.status==="trash"},{default:e(()=>[n(i(o(a)("general.trash")),1)]),_:1},8,["active"])]),_:1})]),g("div",Le,[t(Ce,{count:o(f).length,onClose:o(b)},{default:e(()=>[J((r(),k(ge,{onClick:l[8]||(l[8]=c=>h.value=!0)},{default:e(()=>[t(De)]),_:1})),[[H,o(a)("general.delete")]])]),_:1},8,["count","onClose"]),t(_e,{"with-padding":!1},{default:e(()=>[t(he,null,{head:e(()=>[t(q,null,{default:e(()=>[t(d,{component:"th",scope:"col",class:"w-10"},{default:e(()=>[t(F,{checked:o(x),"onUpdate:checked":l[9]||(l[9]=c=>N(x)?x.value=c:null),disabled:!s.posts.meta.total},null,8,["checked","disabled"])]),_:1}),t(d,{component:"th",scope:"col",class:"w-44"},{default:e(()=>[n(i(o(a)("post.status")),1)]),_:1}),t(d,{component:"th",scope:"col",class:"!pl-0 text-left"},{default:e(()=>[n(i(o(a)("post.content")),1)]),_:1}),t(d,{component:"th",scope:"col",class:"w-48"},{default:e(()=>[n(i(o(a)("post.media")),1)]),_:1}),t(d,{component:"th",scope:"col"},{default:e(()=>[n(i(o(a)("post.labels")),1)]),_:1}),t(d,{component:"th",scope:"col"},{default:e(()=>[n(i(o(a)("post.accounts")),1)]),_:1}),t(d,{component:"th",scope:"col"},{default:e(()=>[n(i(o(a)("post.author")),1)]),_:1}),t(d,{component:"th",scope:"col"})]),_:1})]),body:e(()=>[(r(!0),p(I,null,O(s.posts.data,c=>(r(),k(Ae,{key:c.id,item:c,filter:s.posts.filter,onOnDelete:()=>{o(D)(c.id)}},{checkbox:e(()=>[t(F,{checked:o(f),"onUpdate:checked":l[10]||(l[10]=W=>N(f)?f.value=W:null),value:c.id},null,8,["checked","value"])]),_:2},1032,["item","filter","onOnDelete"]))),128))]),_:1}),s.posts.meta.total?_("",!0):(r(),k(Ie,{key:0,class:"py-md px-md"},{default:e(()=>[n(i(o(a)("post.no_posts_found")),1)]),_:1}))]),_:1}),s.posts.meta.links.length>3?(r(),p("div",qe,[t(Ve,{meta:s.posts.meta,links:s.posts.links},null,8,["meta","links"])])):_("",!0)])]),t(re,{show:h.value,variant:"danger",onClose:l[12]||(l[12]=c=>h.value=!1)},{header:e(()=>[n(i(o(a)("post.delete_posts")),1)]),body:e(()=>[n(i(o(a)("post.confirmation_delete_post")),1)]),footer:e(()=>[t(L,{onClick:l[11]||(l[11]=c=>h.value=!1),class:"mr-xs"},{default:e(()=>[n(i(o(a)("general.cancel")),1)]),_:1}),t(ce,{onClick:E},{default:e(()=>[n(i(o(a)("general.delete")),1)]),_:1})]),_:1},8,["show"])],64)}}};export{yt as default};
