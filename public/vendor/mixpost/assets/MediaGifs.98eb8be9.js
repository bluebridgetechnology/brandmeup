import{I as v,N as U,af as X,l as Y,a1 as A,K as ie,n as ce,o as s,c as k,A as Z,e as p,g as V,P as ue,j as u,H as B,i as L,ap as E,m as T,a as i,ai as de,f as O,t as S,b as t,a0 as me,w as n,F as J,J as q,p as fe,a6 as ee,aE as te,k as se,h as ae}from"./app.3dbb9f4f.js";import{n as ve}from"./index.browser.8e74d592.js";import{_ as G}from"./Masonry.1a75e465.js";import{_ as H}from"./MediaFile.dd3a1c78.js";import{S as pe}from"./SectionTitle.453db892.js";import{_ as le}from"./SearchInput.2b4b1fa0.js";import{_ as ne}from"./NoResult.f7bfb2e6.js";import{_ as oe}from"./Alert.68363348.js";const R=(r="br.media.fetchUploads",y={})=>{const{notify:x}=ce(),P=v("uploads"),f=U(()=>["uploads","stock","gifs"]),C=v(!1),l=v(!1),N=v(!1),g=v(1),d=v([]),$=v(null),w=v(""),_=v([]),h=c=>{const o=_.value.findIndex(e=>e.id===c.id);o<0&&!c.hasOwnProperty("error")&&_.value.push(c),o>=0&&_.value.splice(o,1)},D=()=>{_.value=[]},I=c=>_.value.findIndex(e=>e.id===c.id)!==-1,m=(c=!0)=>{!g.value||(A.start(),axios.get(route(r,y),{params:{page:g.value,keyword:w.value}}).then(function(o){const e=o.data.links.next;e&&(g.value=o.data.links.next.split("?page=")[1]),e||(g.value=0),c||(d.value=o.data.data),c&&(d.value=[...d.value,...o.data.data])}).catch(()=>{x("error",$t("media.error_retrieving_media"))}).finally(()=>{A.done(),C.value=!0}))},b=(c,o)=>{l.value=!0,A.start(),axios.post(route("br.media.download",y),{items:c,from:P.value}).then(e=>{o(e)}).catch(()=>{x("error",$t("media.error_downloading_media"))}).finally(()=>{l.value=!1,A.done(),A.remove()})},j=c=>{d.value=d.value.filter(o=>!c.includes(o.id))},F=(c,o)=>{N.value=!0,A.start(),axios.delete(route("br.media.delete",y),{data:{items:c}}).then(()=>{o()}).catch(()=>{x("error",$t("media.error_deleting_media"))}).finally(()=>{N.value=!1,A.done(),A.remove()})},z=()=>{const c=new IntersectionObserver(o=>{o[0].isIntersecting&&m()});ie(()=>{c.observe($.value)})};return X(w,Y.exports.debounce(()=>{g.value=1,m(!1)},300)),{activeTab:P,tabs:f,isLoaded:C,isDownloading:l,isDeleting:N,keyword:w,page:g,items:d,endlessPagination:$,selected:_,downloadExternal:b,deletePermanently:F,removeItems:j,createObserver:z,toggleSelect:h,deselectAll:D,isSelected:I}},K={__name:"MediaSelectable",props:{active:{type:Boolean,default:!1}},emits:["click"],setup(r){return(y,x)=>(s(),k("div",{onClick:x[0]||(x[0]=P=>y.$emit("click")),class:"w-full relative cursor-pointer box-border"},[Z(y.$slots,"default"),p("div",{class:B(["absolute flex items-center justify-center top-0 right-0 mr-sm mt-sm w-7 h-7 rounded-full border border-white",{"bg-primary-500":r.active,"bg-black bg-opacity-20":!r.active}])},[r.active?(s(),V(ue,{key:0,class:"text-white"})):u("",!0)],2)]))}},ge={class:"relative flex flex-col justify-center"},_e={class:"text-center mb-1"},he={for:"browse",class:"cursor-pointer text-primary-500 hover:text-primary-700 active:text-primary-700 focus:outline-none focus:text-primary-700 transition-colors ease-in-out duration-200"},be={class:"text-sm text-gray-400 text-center"},ke=["accept"],ye={key:0,class:"mt-lg"},xe={__name:"UploadMedia",props:{maxSelection:{type:Number,default:1},combinesMimeTypes:{type:String,default:""},selected:{type:Array,default:[]},toggleSelect:{type:Function},isSelected:{type:Function},columns:{type:Number,default:3}},emits:["mediaSelect"],setup(r,{emit:y}){const x=L("workspaceCtx"),P=r,f=E().props.mixpost.mime_types,C=v(null),l=v(!1),N=e=>{if($.value)return;l.value=!1;const a=d(e.dataTransfer.files);a.length&&z(a)},g=e=>{const a=d(e.target.files);a.length&&(C.value.value=null,z(a))},d=e=>Array.from(e).filter(a=>f.includes(a.type)),$=v(!1),w=v([]),_=v([]),h=v({});X(h,()=>{D(),$.value=Object.keys(h.value).length>0});const D=()=>{h.value.handler&&h.value.handler()},I=e=>{w.value.push(e),Object.keys(h.value).length===0&&m()},m=e=>{Object.keys(h.value).length>0&&(F(h.value,e),P.toggleSelect&&P.toggleSelect(e)),w.value.length>0?(b(w.value[0]),j()):b({})},b=e=>{h.value=e},j=()=>{w.value.shift()},F=(e,a)=>{_.value.push(Object.assign(e,{media:a}))},z=e=>{e.forEach(a=>{I({id:ve(),handler:async()=>{await c(a).then(M=>{m(M)}).catch(M=>{m({name:a.name,error:M.response.data.message})})}})})},c=e=>{const a=new FormData;return a.append("file",e),new Promise((M,W)=>{axios.post(route("br.media.upload",{workspace:x.id}),a).then(function(Q){M(Q.data)}).catch(function(Q){W(Q)})})},o=U(()=>_.value.filter(()=>!0).reverse());return v([]),(e,a)=>(s(),k(J,null,[p("div",{onDragenter:a[2]||(a[2]=T(M=>l.value=!$.value,["prevent"])),onDrop:T(N,["prevent"]),onDragover:a[3]||(a[3]=T(()=>{},["prevent"])),class:B([{"border-gray-700 bg-white":!l.value,"border-cyan-500 bg-cyan-50":l.value},"relative w-full flex items-center justify-center rounded-lg p-10 border-2 border-dashed transition-colors ease-in-out duration-200"])},[p("div",ge,[l.value?(s(),k("div",{key:0,onDragleave:a[0]||(a[0]=T(M=>l.value=!1,["prevent"])),onDragover:a[1]||(a[1]=T(()=>{},["prevent"])),class:"w-full h-full absolute"},null,32)):u("",!0),i(de,{class:B([{"text-stone-700":!l.value,"text-cyan-500":l.value},"!w-16 !h-16 mx-auto mb-xs transition-colors ease-in-out duration-200"])},null,8,["class"]),p("div",_e,[O(S(e.$t("media.drag_drop_files"))+" ",1),p("label",he,S(e.$t("general.browse")),1)]),p("div",be,S(t(f).join(", ")),1)]),$.value?(s(),V(me,{key:0,size:"xl",class:"rounded-lg"})):u("",!0)],34),p("input",{ref_key:"input",ref:C,id:"browse",type:"file",accept:t(f).join(","),multiple:"multiple",class:"hidden",onChange:g},null,40,ke),o.value.length?(s(),k("div",ye,[i(G,{items:o.value,columns:r.columns},{default:n(({item:M})=>[i(K,{active:r.isSelected(M.media),onClick:W=>r.toggleSelect(M.media)},{default:n(()=>[i(H,{media:M.media},null,8,["media"])]),_:2},1032,["active","onClick"])]),_:1},8,["items","columns"])])):u("",!0)],64))}},Be={__name:"MediaUploads",props:{columns:{type:Number,default:3}},setup(r,{expose:y}){const x=L("workspaceCtx"),{page:P,items:f,endlessPagination:C,selected:l,toggleSelect:N,deselectAll:g,removeItems:d,isSelected:$,createObserver:w}=R("br.media.fetchUploads",{workspace:x.id});return q(()=>{w()}),y({selected:l,deselectAll:g,removeItems:d}),(_,h)=>(s(),k(J,null,[i(xe,{"max-selection":4,"combines-mime-types":"",selected:t(l),toggleSelect:t(N),isSelected:t($),columns:r.columns},null,8,["selected","toggleSelect","isSelected","columns"]),p("div",{class:B({"mt-lg":t(f).length})},[t(f).length?(s(),k(J,{key:0},[i(pe,{class:"mb-4"},{default:n(()=>[O(S(_.$t("media.library")),1)]),_:1}),i(G,{items:t(f),columns:r.columns},{default:n(({item:D})=>[D?(s(),V(K,{key:0,active:t($)(D),onClick:I=>t(N)(D)},{default:n(()=>[i(H,{media:D},null,8,["media"])]),_:2},1032,["active","onClick"])):u("",!0)]),_:1},8,["items","columns"])],64)):u("",!0),p("div",{ref_key:"endlessPagination",ref:C,class:"-z-10 w-full"},null,512)],2)],64))}},$e={},we={class:"absolute z-10 bottom-0 mb-xs left-0 ml-xs hidden group-hover:block shadow-mix"},Se={class:"bg-white shadow-mix py-xs px-sm text-left rounded-md"};function Ce(r,y){return s(),k("div",we,[p("div",Se,[Z(r.$slots,"default")])])}const re=fe($e,[["render",Ce]]),Ne={key:0},Ie={key:0,class:"mt-lg"},je=["href"],De=["href"],Ee={__name:"MediaStock",props:{columns:{type:Number,default:3}},setup(r,{expose:y}){const x=L("workspaceCtx"),{user:P}=ee(),f=U(()=>Y.exports.snakeCase(E().props.app.name)),C=U(()=>E().props.is_configured_service.unsplash),{isLoaded:l,keyword:N,page:g,items:d,endlessPagination:$,selected:w,toggleSelect:_,deselectAll:h,isSelected:D,createObserver:I}=R("br.media.fetchStock",{workspace:x.id});return q(()=>{C.value&&I()}),y({selected:w,deselectAll:h}),(m,b)=>(s(),k(J,null,[C.value?(s(),k("div",Ne,[i(le,{modelValue:t(N),"onUpdate:modelValue":b[0]||(b[0]=j=>te(N)?N.value=j:null),placeholder:m.$t("service.unsplash.search")},null,8,["modelValue","placeholder"]),t(d).length?(s(),k("div",Ie,[i(G,{items:t(d),columns:r.columns},{default:n(({item:j})=>[j?(s(),V(K,{key:0,active:t(D)(j),onClick:F=>t(_)(j)},{default:n(()=>[i(H,{media:j,class:"group"},{default:n(()=>[i(re,null,{default:n(()=>[p("div",null,[O(S(m.$t("media.image_source"))+": ",1),p("a",{href:`https://unsplash.com/?utm_source=${f.value}&utm_medium=referral`,target:"_blank",class:"link"},"Unsplash",8,je)]),p("div",null,[O(S(m.$t("media.author"))+": ",1),p("a",{href:`${j.credit_url}?utm_source=${f.value}&utm_medium=referral`,target:"_blank",class:"link"},S(j.name),9,De)])]),_:2},1024)]),_:2},1032,["media"])]),_:2},1032,["active","onClick"])):u("",!0)]),_:1},8,["items","columns"])])):u("",!0),t(l)&&!t(d).length?(s(),V(ne,{key:1,class:"mt-lg"},{default:n(()=>[O(S(m.$t("media.no_images_found")),1)]),_:1})):u("",!0),p("div",{ref_key:"endlessPagination",ref:$,class:"-z-10 w-full"},null,512)])):u("",!0),C.value?u("",!0):(s(),k(J,{key:1},[i(oe,{variant:"warning",closeable:!1},{default:n(()=>[O(S(m.$t("service.not_configured_service",{service:"Unsplash"})),1)]),_:1}),t(P).is_admin?(s(),V(t(ae),{key:0,href:m.route("br.services.index"),class:"block mt-md"},{default:n(()=>[i(se,null,{default:n(()=>[O(S(m.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):u("",!0)],64))],64))}},Pe={key:0},Me={key:0,class:"mt-lg"},Le={__name:"MediaGifs",props:{columns:{type:Number,default:3}},setup(r,{expose:y}){const x=L("workspaceCtx"),{user:P}=ee(),f=U(()=>E().props.is_configured_service.tenor),{isLoaded:C,keyword:l,page:N,items:g,endlessPagination:d,selected:$,toggleSelect:w,deselectAll:_,isSelected:h,createObserver:D}=R("br.media.fetchGifs",{workspace:x.id});return q(()=>{f.value&&D()}),y({selected:$,deselectAll:_}),(I,m)=>(s(),k(J,null,[f.value?(s(),k("div",Pe,[i(le,{modelValue:t(l),"onUpdate:modelValue":m[0]||(m[0]=b=>te(l)?l.value=b:null),placeholder:I.$t("service.tenor.search_gifs")},null,8,["modelValue","placeholder"]),t(g).length?(s(),k("div",Me,[i(G,{items:t(g),columns:r.columns},{default:n(({item:b})=>[b?(s(),V(K,{key:0,active:t(h)(b),onClick:j=>t(w)(b)},{default:n(()=>[(s(),V(H,{media:b,key:b.id,class:"group"},{default:n(()=>[i(re,null,{default:n(()=>[O(S(I.$t("service.tenor.gif")),1)]),_:1})]),_:2},1032,["media"]))]),_:2},1032,["active","onClick"])):u("",!0)]),_:1},8,["items","columns"])])):u("",!0),t(C)&&!t(g).length?(s(),V(ne,{key:1,class:"mt-lg"},{default:n(()=>[O(S(I.$t("media.no_gifs_found")),1)]),_:1})):u("",!0),p("div",{ref_key:"endlessPagination",ref:d,class:"-z-10 w-full"},null,512)])):u("",!0),f.value?u("",!0):(s(),k(J,{key:1},[i(oe,{variant:"warning",closeable:!1},{default:n(()=>[O(S(I.$t("service.not_configured_service",{service:"Tenor"})),1)]),_:1}),t(P).is_admin?(s(),V(t(ae),{key:0,href:I.route("br.services.index"),class:"block mt-md"},{default:n(()=>[i(se,null,{default:n(()=>[O(S(I.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):u("",!0)],64))],64))}};export{Be as _,Ee as a,Le as b,R as u};
